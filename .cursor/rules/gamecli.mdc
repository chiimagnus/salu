---
description: GameCLI 模块开发规范 - 表现层
globs: Sources/GameCLI/**/*.swift
alwaysApply: true
---

# GameCLI 模块开发规范

## 模块定位

GameCLI 是**表现层**，负责终端界面渲染、用户输入处理、国际化。

```
Sources/GameCLI/  ← 本规范适用范围
├── GameCLI.swift       # 主入口、游戏循环
├── Terminal.swift      # ANSI 控制码、终端工具
├── Localization.swift  # 国际化（中/英文）
├── EventFormatter.swift # 事件格式化
├── ScreenRenderer.swift # 屏幕渲染
└── Screens.swift       # 特殊屏幕（标题/帮助/结束）
```

---

## 核心约束

### 必须遵守

- ✅ 所有用户可见文本使用 `Localization` 获取
- ✅ 颜色输出使用 `Terminal` 常量
- ✅ 屏幕刷新使用清屏+重绘模式
- ✅ 开发时使用中文作为默认语言

### 依赖关系

```
GameCLI → GameCore  ✅ 允许
GameCore → GameCLI  ❌ 禁止
```

---

## 文件职责

| 文件 | 职责 |
|------|------|
| `GameCLI.swift` | 主入口、游戏循环、输入处理 |
| `Terminal.swift` | ANSI 颜色码、屏幕控制、工具函数 |
| `Localization.swift` | 中英文国际化、语言切换 |
| `EventFormatter.swift` | 将 BattleEvent 格式化为彩色字符串 |
| `ScreenRenderer.swift` | 构建战斗主界面 |
| `Screens.swift` | 标题/帮助/语言/退出/结果等全屏 |

---

## 国际化规范

### 添加新文本

1. 在 `Localization.swift` 添加属性
2. 提供中文和英文两个版本
3. 在 UI 代码中使用 `Localization.shared.xxx`

```swift
// Localization.swift
var newText: String {
    currentLanguage == .chinese ? "中文文本" : "English text"
}

// 使用
let L = Localization.shared
print(L.newText)
```

### 语言规范

- **开发语言**：中文（所有注释、文档用中文）
- **支持语言**：中文、英文
- **默认语言**：中文

---

## 终端控制

### 颜色使用

```swift
// 使用 Terminal 常量
print("\(Terminal.red)错误文本\(Terminal.reset)")
print("\(Terminal.bold)\(Terminal.green)成功\(Terminal.reset)")

// 可用颜色
Terminal.red      // 红色（敌人、伤害、错误）
Terminal.green    // 绿色（玩家、成功、可用）
Terminal.yellow   // 黄色（能量、警告、意图）
Terminal.blue     // 蓝色（玩家名称）
Terminal.cyan     // 青色（格挡、回合信息）
Terminal.magenta  // 洋红（特殊效果）
Terminal.bold     // 加粗
Terminal.dim      // 暗淡
Terminal.reset    // 重置
```

### 屏幕刷新

```swift
// 清屏并刷新整个界面
Terminal.clear()  // 清屏 + 光标归位
// ... 打印所有内容 ...
Terminal.flush()  // 刷新缓冲区
```

---

## 界面布局

战斗主界面固定布局：

```
┌─────────────────────────────────────────────┐
│ 标题栏（回合数、种子）                         │
├─────────────────────────────────────────────┤
│ 敌人区域（名称、HP条、格挡、意图）              │
├ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─┤
│ 玩家区域（名称、HP条、格挡、能量）              │
├─────────────────────────────────────────────┤
│ 手牌区域（卡牌列表）                          │
├─────────────────────────────────────────────┤
│ 牌堆信息（抽牌堆/弃牌堆）                      │
├─────────────────────────────────────────────┤
│ 事件日志（最近6条）                           │
├─────────────────────────────────────────────┤
│ 消息区域（错误提示等）                        │
├━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┤
│ 操作提示栏                                   │
└─────────────────────────────────────────────┘
```

---

## 输入处理

| 输入 | 操作 |
|------|------|
| `1-N` | 打出第 N 张手牌 |
| `0` | 结束回合 |
| `h` | 显示帮助 |
| `l` | 切换语言 |
| `q` | 退出游戏 |

---

## 检查清单

- [ ] 用户可见文本使用 Localization
- [ ] 颜色使用 Terminal 常量
- [ ] 屏幕刷新使用清屏模式
- [ ] 新增文本提供中英文版本
- [ ] 界面布局保持一致
