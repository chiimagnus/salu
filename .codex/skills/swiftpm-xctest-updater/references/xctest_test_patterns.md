## XCTest（SwiftPM）单测风格速查

### 目标
- 用例应当是“真实断言”，优先锁定行为/事件，避免纯占位。
- 尽量保持 `swift test` 全绿；红了就最小修复到绿（允许小范围改 `Sources/` 以提升可测性/确定性）。

### 常用模式（从仓库现状提炼）
- **确定性 RNG/Clock**：显式传 `seed`，或注入可控 RNG/Clock，避免系统随机与时序依赖。
- **通过稳定入口驱动**：尽量从公开 API 或核心流程入口驱动行为，再对状态/事件/输出做断言。
- **避免真实 I/O**：用协议/闭包注入替代落盘、网络、真实用户目录等；优先 In-Memory stub/fake。
- **stdout 比对**：需要时捕获 stdout/stderr 并去除 ANSI/时间戳等噪声，让断言更稳定。

### “往哪里补测试”启发式（通用）
- 优先找现有按功能聚合的 `*Tests.swift` 追加用例（保持测试组织一致）。
- 如果新增：优先放在 `Tests/<TargetName>Tests/`（若存在）并围绕一个能力/子系统命名。
